CREATE ALGORITHM=UNDEFINED DEFINER=`renato`@`%` SQL SECURITY DEFINER VIEW `company_chooser_header` AS select `c`.`id` AS `companies_id`,`t`.`id` AS `trabajadores_id`,`t`.`nombre` AS `f_nombre`,lower(concat(substr(`t`.`nombre`,1,1),'.',substring_index(`t`.`nombre`,' ',-(1)),'.',substring_index(`c`.`f_nombre`,' ',1))) AS `f_username`,`r`.`rol` AS `f_rol`,date_format((`t`.`updated_at` - interval 6 hour),'%M %d, %Y a las %H:%i:%s') AS `f_last_access`,((select count(0) from `companies` where (`companies`.`deleted_at` is null)) - 1) AS `f_company_count`,(select sum(`companies`.`f_renta`) from `companies` where (`companies`.`deleted_at` is null)) AS `f_mensualidad` from ((`trabajadores` `t` left join `companies` `c` on((`t`.`empresa` = `c`.`id`))) left join `roles` `r` on((`r`.`id` = `t`.`rol`)))