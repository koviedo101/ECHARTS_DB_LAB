CREATE ALGORITHM=UNDEFINED DEFINER=`renato`@`%` SQL SECURITY DEFINER VIEW `i_sueldos_mensuales` AS select year(`v`.`fecha`) AS `year`,month(`v`.`fecha`) AS `mes`,`v`.`employee_id` AS `employee_id`,(sum(`v`.`ordinario`) + min(ifnull(`p`.`prestaciones`,0))) AS `ordinario`,sum(`v`.`extra`) AS `extra` from ((`v_planilla` `v` left join `trabajadores` `e` on((`e`.`id` = `v`.`employee_id`))) left join `prestaciones` `p` on(((`v`.`employee_id` = `p`.`employee_id`) and (month(`v`.`fecha`) = `p`.`mes`) and (year(`v`.`fecha`) = `p`.`year`)))) group by year(`v`.`fecha`),month(`v`.`fecha`),`v`.`employee_id`