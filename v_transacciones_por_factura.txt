CREATE ALGORITHM=UNDEFINED DEFINER=`renato`@`%` SQL SECURITY DEFINER VIEW `v_transacciones_por_factura` AS select `t`.`factura_id` AS `factura_id`,`f`.`descripcion` AS `factura`,`c`.`id` AS `cliente_id`,`c`.`nombre` AS `cliente`,min(`p`.`nombre`) AS `project`,min(`p`.`id`) AS `project_id`,min(`p`.`company_id`) AS `company_id`,ifnull(sum(`t`.`cobro`),0) AS `cobrado`,ifnull(sum(`t`.`pago`),0) AS `pagado`,ifnull((sum(`t`.`cobro`) - sum(`t`.`pago`)),0) AS `saldo` from (((`transacciones` `t` left join `facturas_emitidas` `f` on((`f`.`id` = `t`.`factura_id`))) left join `projects` `p` on((`p`.`id` = `f`.`project_id`))) left join `clientes` `c` on((`c`.`id` = `p`.`cliente_id`))) group by `t`.`factura_id`,`c`.`id`