CREATE ALGORITHM=UNDEFINED DEFINER=`renato`@`%` SQL SECURITY DEFINER VIEW `v_trabajo` AS select `t`.`employee_id` AS `id`,`t`.`project_id` AS `project_id`,min(`e`.`nombre`) AS `employee`,date_format(min(`t`.`fecha`),'%a, %e-%b') AS `inicio`,date_format(max(`t`.`fecha`),'%a, %e-%b') AS `fin`,(sum((case when (`o`.`cumplido` >= `o`.`objetivo`) then ((`e`.`sueldo` * `o`.`multiplicador_extra`) * `o`.`multiplicador_feriado`) when (`o`.`cumplido` < `o`.`objetivo`) then (((`e`.`sueldo` / 8) * `o`.`cumplido`) * `o`.`multiplicador_feriado`) else 0 end)) + sum(if((`o`.`cumplido` > `o`.`objetivo`),(((`o`.`cumplido` - `o`.`objetivo`) * (`e`.`sueldo` / 8)) * `e`.`multiplicador_extra`),0))) AS `monto` from ((`i_objetivos` `o` left join `trabajo` `t` on(((`t`.`fecha` = `o`.`fecha`) and (`t`.`employee_id` = `o`.`employee_id`)))) left join `trabajadores` `e` on((`t`.`employee_id` = `e`.`id`))) group by `t`.`employee_id`,`t`.`project_id` order by `inicio`