CREATE ALGORITHM=UNDEFINED DEFINER=`renato`@`%` SQL SECURITY DEFINER VIEW `prestaciones` AS select `v`.`employee_id` AS `employee_id`,month(`v`.`fecha`) AS `mes`,year(`v`.`fecha`) AS `year`,sum(`v`.`sueldo`) AS `prestaciones` from ((select `d`.`fecha` AS `fecha`,`jk`.`sueldo` AS `sueldo`,`jk`.`id` AS `employee_id` from (`descansos` `d` join `trabajadores` `jk` on((`jk`.`rol` = 4)))) `v` left join `trabajo` `t` on(((`t`.`fecha` = `v`.`fecha`) and (`v`.`employee_id` = `t`.`employee_id`)))) where (`t`.`id` is null) group by `v`.`employee_id`,month(`v`.`fecha`),year(`v`.`fecha`)